<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manual Order Page</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f2f4f8;padding:15px}
.container{max-width:580px;margin:auto;background:#fff;padding:20px;border-radius:12px}
h1{text-align:center;color:#0d6efd;margin-bottom:5px}
h2{text-align:center;font-size:14px;color:#555}
input,select,textarea{
  width:100%;padding:12px;margin:6px 0;
  border:1px solid #ccc;border-radius:6px;font-size:15px
}
textarea{resize:none}
.box{border:1px dashed #ccc;padding:10px;border-radius:6px;margin-top:10px}
.radio{display:flex;justify-content:space-around}
.note{font-size:12px;color:#c00}
button{
  width:100%;padding:14px;margin-top:15px;
  background:#28a745;color:#fff;border:none;
  border-radius:6px;font-size:16px
}
#deliveryEstimate{white-space:pre-line;color:green;font-size:14px;margin-top:6px}
#miniPreview{display:none;font-size:14px;margin-top:8px}
</style>
</head>

<body>
<div class="container">

<h1>Manual Order Page</h1>
<h2>Fill details carefully</h2>

<input id="name" placeholder="Name">
<input id="mobile" placeholder="Mobile">
<input id="altmobile" placeholder="Alt Mobile">
<input id="email" placeholder="Email">

<textarea id="address" placeholder="Full Address"></textarea>
<input id="landmark" placeholder="Landmark">

<input id="pincode" placeholder="Pincode">
<input id="state" placeholder="State" readonly>
<input id="city" placeholder="District/City" readonly>

<select id="postoffice">
  <option value="">Select Post Office</option>
</select>

<div id="deliveryEstimate"></div>

<div id="miniPreview">
  <div>‚è≥ Prepaid ETA: <span id="preEta"></span></div>
  <div>üìÖ Prepaid Delivery: <span id="preRange"></span></div>
  <div>‚è≥ COD ETA: <span id="codEta"></span></div>
  <div>üìÖ COD Delivery: <span id="codRange"></span></div>
</div>

<input type="hidden" id="distance">
<input type="hidden" id="etaText">
<input type="hidden" id="dateRange">

<div class="box">
<b>Order Type</b>
<div class="radio">
<label><input type="radio" name="otype" value="Prepaid" checked> Prepaid</label>
<label><input type="radio" name="otype" value="COD"> COD</label>
</div>
</div>

<div class="box">
<b>Product</b>
<select id="product" onchange="setProduct()">
<option value="">Select Product</option>
<option data-price="3199" data-old="3899" data-variant="64GB">OG GameStick GD30 V3</option>
<option data-price="4699" data-old="5499" data-variant="64GB">G90 Handheld</option>
<option data-price="2499" data-old="4599" data-variant="64GB">R35S Handheld</option>
<option data-price="2699" data-old="4999" data-variant="64GB">R36S Handheld</option>
<option data-price="3299" data-old="4999" data-variant="64GB">R36 Ultra Handheld</option>
<option data-price="799" data-old="900">SUP Classic</option>
<option data-price="999" data-old="1199">SUP X7M</option>
</select>

<input id="manualProduct" placeholder="Manual product (No discount)">
<div class="note">Manual product = NO DISCOUNT / NO BARGAIN</div>
</div>

<input id="qty" type="number" min="1" value="1">

<div class="box">
<b>Coupon</b>
<input id="coupon" placeholder="Coupon Code">
<div class="note">Hint: freekagame</div>
</div>

<button onclick="sendOrder()">Submit Order on WhatsApp</button>

</div>

<script>
/* ===== PRODUCT / PRICE ===== */
let basePrice=0,discount=0,variant="";
function setProduct(){
  const o=product.options[product.selectedIndex];
  if(!o.dataset.price) return;
  basePrice=parseInt(o.dataset.price);
  discount=parseInt(o.dataset.old)-basePrice;
  variant=o.dataset.variant||"";
}

/* ===== COUPON ===== */
function validCoupon(c){
  return ["gpz2025","gpz2026"].includes(c.toLowerCase());
}

/* ===== ORDER ID ===== */
function orderID(){
  const d=new Date();
  return d.getDate().toString().padStart(2,'0')+
  (d.getMonth()+1).toString().padStart(2,'0')+
  d.getFullYear()+
  d.getHours().toString().padStart(2,'0')+
  d.getMinutes().toString().padStart(2,'0')+
  d.getSeconds().toString().padStart(2,'0')+"00";
}
</script>

<!-- ===== ETA / PINCODE SYSTEM (UNCHANGED ‚Äì TERA CODE) ===== -->
<script>
let pincodeLatLng={};
fetch('pincode_data.json').then(r=>r.json()).then(j=>pincodeLatLng=j);

function haversine(lat1,lon1,lat2,lon2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180, dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  return 2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

function etaByDist(d){
  if(d<=30)return"1 day";
  if(d<=60)return"1-2 days";
  if(d<=100)return"2-3 days";
  if(d<=200)return"3-4 days";
  if(d<=500)return"4-5 days";
  if(d<=1000)return"4-6 days";
  if(d<=1500)return"5‚Äì7 days";
  if(d<=2000)return"6‚Äì8 days";
  if(d<=3000)return"6‚Äì10 days";
  return"8‚Äì12 days";
}

function parseEta(eta){
  const n=(eta.match(/\d+/g)||[]).map(Number);
  if(n.length===1) return {min:n[0],max:n[0]};
  return {min:Math.min(...n),max:Math.max(...n)};
}

function dayStartOffset(){
  const n=new Date();
  return (n.getDay()>=1 && n.getDay()<=5 && n.getHours()>=19)?1:0;
}

function formatDateRange(min,max){
  const o=dayStartOffset();
  const s=new Date(),e=new Date();
  s.setDate(s.getDate()+min+o);
  e.setDate(e.getDate()+max+o);
  const opt={weekday:"long",day:"2-digit",month:"long",year:"numeric"};
  return `${s.toLocaleDateString("en-IN",opt)} ‚Äì ${e.toLocaleDateString("en-IN",opt)}`;
}

document.getElementById("pincode").addEventListener("input",function(){
  const pin=this.value.trim();
  if(pin.length===6){
    fetch(`https://api.postalpincode.in/pincode/${pin}`)
    .then(r=>r.json()).then(data=>{
      if(data[0].Status==="Success"){
        const po=data[0].PostOffice[0];
        state.value=po.State;
        city.value=po.District;
        postoffice.innerHTML='<option value="">Select Post Office</option>';
        data[0].PostOffice.forEach(p=>{
          const o=document.createElement("option");
          o.value=o.text=p.Name;postoffice.appendChild(o);
        });

        if(pincodeLatLng[pin]){
          const baseLat=28.8,baseLng=79.0;
          const {lat,lng}=pincodeLatLng[pin];
          const d=Math.round(haversine(baseLat,baseLng,lat,lng));
          const eta=etaByDist(d);
          const pre=parseEta(eta);
          const preRange=formatDateRange(pre.min,pre.max);
          const cod={min:pre.min+2,max:pre.max+3};

          distance.value=d+" km";
          etaText.value=eta;
          dateRange.value=preRange;

          preEta.textContent=eta;
          preRange.textContent=preRange;
          codEta.textContent=`${cod.min}‚Äì${cod.max} days`;
          codRange.textContent=formatDateRange(cod.min,cod.max);

          deliveryEstimate.innerText=
`üìè Distance: ${d} km
‚è≥ Prepaid ETA: ${eta}
üìÖ Prepaid Delivery: ${preRange}`;

          miniPreview.style.display="block";
        }
      }
    });
  }
});
</script>

<script>
/* ===== SEND WHATSAPP ===== */
function sendOrder(){
  const type=document.querySelector('input[name="otype"]:checked').value;
  const q=parseInt(qty.value);
  const dsc= validCoupon(coupon.value)?discount:0;

  const total=(basePrice-dsc)*q;
  const codCharge= type==="COD"?199*q:0;
  const adv= type==="COD"?500*q:0;
  const bal= total+codCharge-adv;

  const msg=`${type==="COD"?"üî¥ COD":"üü¢ Prepaid"} Order on WhatsApp

Order ID: ${orderID()}
Name: ${name.value}
Mobile: ${mobile.value}
Alt Mobile: ${altmobile.value}
Email: ${email.value}
Address: ${address.value}
Landmark: ${landmark.value}
Pincode: ${pincode.value}
State: ${state.value}
District/City: ${city.value}
Post office: ${postoffice.value}

Product: ${product.value||manualProduct.value}
Variant: ${variant}
Base Price: ‚Çπ${basePrice}
Discount Applied: ‚Çπ${dsc}
Amount Paid: ‚Çπ${type==="COD"?adv:total}
${type==="COD"?"Rest on Delivery: ‚Çπ"+bal:""}

üìè Distance: ${distance.value}
‚è≥ ${type} Order ETA: ${type==="COD"?codEta.textContent:etaText.value}
üìÖ Estimated Delivery: ${type==="COD"?codRange.textContent:dateRange.value}
`;

  window.open("https://wa.me/917983624797?text="+encodeURIComponent(msg));
}
</script>

</body>
</html>
